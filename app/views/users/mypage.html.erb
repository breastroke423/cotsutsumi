<div class="container">
  <h2>マイページ</h2>
  <div class="row">
    <div class="col-xs-6 profile">
      <div class="profile-image">
        <%= attachment_image_tag @user, :profile_image, :fill, 60, 60, format: 'jpeg', class: "img-circle pull-left profile-img", fallback: "no_image.jpg" %>
      </div>
      <div class="nickname">
        <%= current_user.nickname %>
      </div>
    </div>

    <div class="col-xs-6 follow">
      <%= link_to user_follows_path(current_user.id) do %>
      フォロー一覧（<%= @user.followings.count %>）
      <% end %>

      <%= link_to user_followers_path(current_user.id) do %>
      フォロワー一覧（<%= @user.followers.count %>）
      <% end %>

      <p class="fix"><%= link_to "プロフィール変更", edit_user_path(current_user) %></p>
    </div>
  </div>
  <div class="row saving">
    <h3>通算ガマン</h3>
    <h3><%= @user_total_price.to_s(:delimited) %>円／<%= @waste_count_all %>回</h3>
    <h3>現在の積立 (通算-購入額)</h3>
    <h3><%= @user_difference_price.to_s(:delimited) %>円</h3>
  </div>
  <!-- ↑合計から購入金額抜いた額 -->
  <!-- <h3>継続日数</h3>カレンダー機能の時に -->
  <div class="row mytable table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th></th>
          <th>無駄遣い</th>
          <th>金額</th>
          <th>通算ガマン</th>
          <th>本日のガマン</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @user.wastes.each do |waste| %>
        <tr>
          <td></td>
          <td><%= waste.name %></td>
          <td><%= waste.price.to_s(:delimited) %>円</td>

          <td><%= (waste.price * waste.count).to_s(:delimited) %>円／<%= waste.count %>回</td>
          <td><%= button_to "ガマン！", {controller: 'wastes', action: 'count_up'}, {method: :patch, :class => "btn btn-success", params: {waste: waste.id}} %>
          </td>
          <td><%= button_to "使った…", {controller: 'wastes', action: 'count_down'}, {method: :patch, :class => "btn btn-danger", params: {waste: waste.id}} %>
          </td>

        </tr>
      </tbody>
      <% end %>
    </table>
  </div>
  <div class="index-btn">
    <%= link_to "無駄遣い変更/追加", wastes_path, data: {"turbolinks" => false}, class: "btn btn-success" %>
  </div>


  <div class="row mytable table-responsive">
    <table class="table">
      <h3>欲しい目標</h3>
      <thead>
        <tr>
          <th class="col-xs-1">　　　　</th>
          <th class="col-xs-2">目標　　</th>
          <th class="col-xs-3">購入金額</th>
          <th class="col-xs-2">理由　　</th>
          <th class="col-xs-2">目標まで</th>
          <th class="col-xs-2">　　　　</th>
        </thead>
        <tbody>
          <tr>
            <% @user.wants.each do |want| %>
            <td class="col-xs-1"><%= want.cheers.count %><i class="fa fa-child" aria-hidden="true" style="color:red;"></i></td>
            <td class="col-xs-1">
              <div class="resize">
                <%= attachment_image_tag want, :want_image, :fill, 45, 45, fallback: "no_image.jpg" %><br><%= want.name %>
              </div></td>
              <td class="col-xs-1"><%= want.price.to_s(:delimited) %>円</td>
              <td class="col-xs-1"><%= want.reason %></td>
              <% if want.price-@user_difference_price <= 0 %>
              <td class="col-xs-1"><%= bar_chart [['積立金', @user_difference_price], [want.name, want.price]], thousands: ",", width: "200px", height: "100px", colors: ["#b00", "#666"] %></td>
              <td class="col-xs-1"><%= link_to want_path(want), class: "btn btn-primary" do %>
               積み立てた<br>お金で買う
               <% end %>
             </td>
             <% else %>
             <td class="col-xs-1"><%= bar_chart [['積立金', @user_difference_price], [want.name, want.price]], thousands: ",", width: "200px", height: "100px", colors: ["#4242ff", "#ffd1a3"] %></td>
             <td class="col-xs-1">あと<br><%= (want.price-@user_difference_price).to_s(:delimited) %>円</td>
             <% end %>
           </tr>
           <% end %>
         </tbody>
       </table>
     </div>
     <div class="index-btn">
      <%= link_to "目標変更", wants_path, data: {"turbolinks" => false}, class: "btn btn-success" %>
    </div>
  </div>